<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glucose Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial;
            margin: 20px;
        }

        form, table {
            width: 100%;
            max-width: 600px;
            margin: auto;
        }

        input, button {
            margin: 5px;
            padding: 10px;
            width: 100%;
        }

        canvas {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <h1>Glucose Tracker</h1>
    <form id="glucoseForm">
        <input type="date" id="date" required>
        <input type="time" id="time" required>
        <input type="number" step="0.1" id="glucose" placeholder="Glucose (mmol)" required>
        <input type="text" id="comments" placeholder="Comments">
        <button type="submit">Add Reading</button>
    </form>

    <table border="1" id="dataTable">
        <thead><tr><th>Date</th><th>Time</th><th>Glucose</th><th>Comments</th></tr></thead>
        <tbody></tbody>
    </table>

    <h2>Glucose Trend</h2>
    <canvas id="glucoseChart"></canvas>

    <button id="saveDrive">Save to Google Drive</button>

    https://apis.google.com/js/api.js</script>
    <script>
const CLIENT_ID = '<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Glucose Tracker</title>
https://cdn.jsdelivr.net/npm/chart.js</script>
<style>
  body { font-family: Arial; margin: 20px; }
  form, table { width: 100%; max-width: 600px; margin: auto; }
  input, button { margin: 5px; padding: 10px; width: 100%; }
  canvas { max-width: 100%; }
</style>
</head>
<body>
<h1>Glucose Tracker</h1>
<form id="glucoseForm">
  <input type="date" id="date" required>
  <input type="time" id="time" required>
  <input type="number" step="0.1" id="glucose" placeholder="Glucose (mmol)" required>
  <input type="text" id="comments" placeholder="Comments">
  <button type="submit">Add Reading</button>
</form>

<table border="1" id="dataTable">
<thead><tr><th>Date</th><th>Time</th><th>Glucose</th><th>Comments</th></tr></thead>
<tbody></tbody>
</table>

<h2>Glucose Trend</h2>
<canvas id="glucoseChart"></canvas>

<button id="saveDrive">Save to Google Drive</button>

<script src="https://apis.google.com/js/api.js"</script>

const CLIENT_ID = '774449140663-d7ufgeqonjvmph6dliijgrv2mf0n5jc3.apps.googleusercontent.com';
const SCOPES = 'https://www.googleapis.com/auth/drive.file';
let readings = [], chart;

document.getElementById('glucoseForm').addEventListener('submit', e => {
  e.preventDefault();
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;
  const glucose = document.getElementById('glucose').value;
  const comments = document.getElementById('comments').value;
  readings.push({ date, time, glucose, comments });
  updateTable(); updateChart();
});

function updateTable() {
  const tbody = document.querySelector('#dataTable tbody');
  tbody.innerHTML = '';
  readings.forEach(r => {
    tbody.innerHTML += `<tr><td>${r.date}</td><td>${r.time}</td><td>${r.glucose}</td><td>${r.comments}</td></tr>`;
  });
}

function updateChart() {
  const labels = readings.map(r => `${r.date} ${r.time}`);
  const data = readings.map(r => parseFloat(r.glucose));
  if (chart) chart.destroy();
  chart = new Chart(document.getElementById('glucoseChart'), {
    type: 'line',
    data: { labels, datasets: [{ label: 'Glucose (mmol)', data, borderColor: 'blue', fill: false }] }
  });
}

function exportCSV() {
  let csv = 'Date,Time,Glucose,Comments\n';
  readings.forEach(r => csv += `${r.date},${r.time},${r.glucose},${r.comments}\n`);
  return new Blob([csv], { type: 'text/csv' });
}

document.getElementById('saveDrive').addEventListener('click', () => {
  gapi.load('client:auth2', () => {
    gapi.client.init({ clientId: CLIENT_ID, scope: SCOPES }).then(() => {
      gapi.auth2.getAuthInstance().signIn().then(() => {
        const fileContent = exportCSV();
        const metadata = { name: 'glucose_readings.csv', mimeType: 'text/csv' };
        const form = new FormData();
        form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
        form.append('file', fileContent);
        fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
          method: 'POST',
          headers: new Headers({ 'Authorization': 'Bearer ' + gapi.auth.getToken().access_token }),
          body: form
        }).then(res => res.json()).then(() => alert('File saved to Google Drive!'));
      });
    });
  });
});
</script>
</body>
</html>';
const SCOPES = 'https://www.googleapis.com/auth/drive.file';
let readings = [], chart;

document.getElementById('glucoseForm').addEventListener('submit', e => {
  e.preventDefault();
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;
  const glucose = document.getElementById('glucose').value;
  const comments = document.getElementById('comments').value;
  readings.push({ date, time, glucose, comments });
  updateTable(); updateChart();
});

function updateTable() {
  const tbody = document.querySelector('#dataTable tbody');
  tbody.innerHTML = '';
  readings.forEach(r => {
    tbody.innerHTML += `<tr><td>${r.date}</td><td>${r.time}</td><td>${r.glucose}</td><td>${r.comments}</td></tr>`;
  });
}

function updateChart() {
  const labels = readings.map(r => `${r.date} ${r.time}`);
  const data = readings.map(r => parseFloat(r.glucose));
  if (chart) chart.destroy();
  chart = new Chart(document.getElementById('glucoseChart'), {
    type: 'line',
    data: { labels, datasets: [{ label: 'Glucose (mmol)', data, borderColor: 'blue', fill: false }] }
  });
}

function exportCSV() {
  let csv = 'Date,Time,Glucose,Comments\n';
  readings.forEach(r => csv += `${r.date},${r.time},${r.glucose},${r.comments}\n`);
  return new Blob([csv], { type: 'text/csv' });
}

document.getElementById('saveDrive').addEventListener('click', () => {
  gapi.load('client:auth2', () => {
    gapi.client.init({ clientId: CLIENT_ID, scope: SCOPES }).then(() => {
      gapi.auth2.getAuthInstance().signIn().then(() => {
        const fileContent = exportCSV();
        const metadata = { name: 'glucose_readings.csv', mimeType: 'text/csv' };
        const form = new FormData();
        form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
        form.append('file', fileContent);
        fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
          method: 'POST',
          headers: new Headers({ 'Authorization': 'Bearer ' + gapi.auth.getToken().access_token }),
          body: form
        }).then(res => res.json()).then(() => alert('File saved to Google Drive!'));
      });
    });
  });
});
    </script>
</body>
</html>